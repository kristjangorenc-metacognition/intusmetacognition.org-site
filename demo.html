<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INTUS Demo — Cross-Document Contradiction Detection</title>
    <style>
        :root {
            --bg-dark: #0d1117;
            --bg-card: #161b22;
            --border: #30363d;
            --text: #c9d1d9;
            --text-muted: #8b949e;
            --accent-blue: #58a6ff;
            --accent-green: #3fb950;
            --accent-orange: #d29922;
            --accent-red: #f85149;
            --accent-purple: #a371f7;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            line-height: 1.5;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 24px; }
        
        header {
            text-align: center;
            padding: 32px 0 24px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 32px;
        }
        header h1 {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        header h1 span { color: var(--accent-blue); }
        header .subtitle { color: var(--text-muted); font-size: 1.1rem; }
        header .meta { 
            margin-top: 12px; 
            font-size: 0.85rem; 
            color: var(--text-muted);
            line-height: 1.6;
        }
        
        .proofs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }
        .proof-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }
        .proof-card.pass { border-left: 4px solid var(--accent-green); }
        .proof-card.warn { border-left: 4px solid var(--accent-orange); }
        .proof-card h3 { font-size: 0.9rem; font-weight: 500; margin-bottom: 4px; }
        .proof-card .value { font-size: 0.85rem; color: var(--text-muted); }
        .proof-card .icon { font-size: 1.5rem; margin-bottom: 8px; }
        .proof-card.pass .icon { color: var(--accent-green); }
        .proof-card.warn .icon { color: var(--accent-orange); }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 24px;
        }
        @media (max-width: 1000px) {
            .main-grid { grid-template-columns: 1fr; }
        }
        
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }
        .card-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            font-weight: 600;
        }
        .card-body { padding: 16px; }
        
        #graph-container {
            width: 100%;
            height: 500px;
            background: var(--bg-dark);
        }
        #graph-container svg { width: 100%; height: 100%; }
        
        .node circle { stroke: var(--text); stroke-width: 1.5px; cursor: pointer; }
        .node.reg circle { fill: var(--accent-blue); }
        .node.dir circle { fill: var(--accent-purple); }
        .node text { fill: var(--text); font-size: 10px; pointer-events: none; }
        .link { stroke: var(--text-muted); stroke-opacity: 0.6; }
        .link.timeline { stroke: var(--accent-orange); }
        .link.access { stroke: var(--accent-green); }
        .link.governance { stroke: var(--accent-blue); }
        .link.qualified_person { stroke: var(--accent-purple); }
        
        .legend {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            padding: 12px 16px;
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
        }
        .legend-item { display: flex; align-items: center; gap: 6px; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; }
        
        .region-list { max-height: 450px; overflow-y: auto; }
        .region-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.15s;
        }
        .region-item:hover { background: rgba(88, 166, 255, 0.1); }
        .region-item:last-child { border-bottom: none; }
        .region-item .axis-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            margin-bottom: 6px;
        }
        .region-item .axis-tag.timeline { background: rgba(210,153,34,0.2); color: var(--accent-orange); }
        .region-item .axis-tag.access { background: rgba(63,185,80,0.2); color: var(--accent-green); }
        .region-item .axis-tag.governance { background: rgba(88,166,255,0.2); color: var(--accent-blue); }
        .region-item .axis-tag.qualified_person { background: rgba(163,113,247,0.2); color: var(--accent-purple); }
        .region-item .pair-label { font-weight: 500; margin-bottom: 4px; }
        .region-item .stats { font-size: 0.85rem; color: var(--text-muted); }
        
        .tooltip {
            position: absolute;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 12px;
            max-width: 300px;
            font-size: 0.85rem;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }
        .tooltip .doc { color: var(--accent-blue); font-weight: 500; }
        .tooltip .sec { color: var(--accent-purple); }
        .tooltip .text { margin-top: 8px; color: var(--text-muted); }
        
        .graph-fallback {
            padding: 16px;
            max-height: 480px;
            overflow-y: auto;
        }
        .graph-fallback .fallback-header {
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-muted);
        }
        .graph-fallback .fallback-pair {
            padding: 8px 12px;
            margin-bottom: 8px;
            background: var(--bg-dark);
            border-radius: 6px;
            font-size: 0.9rem;
        }
        .graph-fallback .vs {
            color: var(--accent-red);
            margin: 0 8px;
        }
        .graph-fallback .strength {
            color: var(--text-muted);
            margin-left: 8px;
        }
        
        footer {
            margin-top: 48px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        footer a {
            color: var(--accent-blue);
            text-decoration: none;
        }
        footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><span>INTUS</span> Demo Dashboard</h1>
            <div class="subtitle">Cross-Document Contradiction Detection in Regulatory Text</div>
            <div class="meta">
                EU Veterinary Pharmacovigilance Regulations<br>
                Directive 2001/82/EC vs Regulation 2019/6<br>
                Demonstration completed January 2026
            </div>
        </header>
        
        <div class="proofs-grid">
            <div class="proof-card pass">
                <div class="icon">✓</div>
                <h3>Cross-Document Edges</h3>
                <div class="value">3 detected</div>
            </div>
            <div class="proof-card pass">
                <div class="icon">✓</div>
                <h3>Tension Clusters</h3>
                <div class="value">3 regions</div>
            </div>
            <div class="proof-card warn">
                <div class="icon">⚡</div>
                <h3>Mean Strength</h3>
                <div class="value">99.97%</div>
            </div>
            <div class="proof-card pass">
                <div class="icon">✓</div>
                <h3>Traceability</h3>
                <div class="value">Full provenance</div>
            </div>
        </div>
        
        <div class="main-grid">
            <div class="card">
                <div class="card-header">Contradiction Network</div>
                <div class="card-body">
                    <div id="graph-container">
                        <!-- D3 graph renders here if available -->
                        <div class="graph-fallback">
                            <div class="fallback-header">Detected Contradictions (fallback view)</div>
                            <div class="fallback-pair">
                                <strong>REG_2019_6 Art77</strong> <span class="vs">⟂</span> <strong>DIR_2001_82 Art75</strong>
                                <span class="strength">(99.97%)</span>
                            </div>
                            <div class="fallback-pair">
                                <strong>DIR_2001_82 Art1</strong> <span class="vs">⟂</span> <strong>REG_2019_6 Art77</strong>
                                <span class="strength">(99.97%)</span>
                            </div>
                            <div class="fallback-pair">
                                <strong>DIR_2001_82 Art1</strong> <span class="vs">⟂</span> <strong>REG_2019_6 Art77</strong>
                                <span class="strength">(99.97%)</span>
                            </div>
                        </div>
                    </div>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-dot" style="background: var(--accent-blue);"></div>
                            <span>Regulation 2019/6</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: var(--accent-purple);"></div>
                            <span>Directive 2001/82</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: var(--accent-orange);"></div>
                            <span>Timeline conflict</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: var(--accent-green);"></div>
                            <span>Access conflict</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: var(--accent-blue);"></div>
                            <span>Governance conflict</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">Detected Tension Regions</div>
                <div class="region-list" id="region-list"></div>
            </div>
        </div>
        
        <footer>
            <p>
                This demonstration shows INTUS detecting cross-document semantic tensions 
                between EU veterinary pharmacovigilance regulations.
            </p>
            <p style="margin-top: 12px;">
                <a href="index.html">← Return to INTUS Metacognition Laboratory</a>
            </p>
            <p style="margin-top: 12px; font-size: 0.75rem;">
                All contradictions are traceable to source document clauses and NLI detector judgments.
            </p>
        </footer>
    </div>
    
    <div id="tooltip" class="tooltip"></div>
    
    <script>
        // Graph data for D3 visualization
        const graphData = {
            "nodes": [
                {"id": "REG_2019_6::Art77(1-11)", "doc": "REG_2019_6", "sec": "Art77(1-11)", "group": 1, 
                 "text": "Marketing authorisation holder pharmacovigilance obligations"},
                {"id": "DIR_2001_82::Art75(1-2)", "doc": "DIR_2001_82", "sec": "Art75(1-2)", "group": 2,
                 "text": "Detailed records of suspected adverse reactions"},
                {"id": "DIR_2001_82::Art1_10,12", "doc": "DIR_2001_82", "sec": "Art1_10,12", "group": 2,
                 "text": "Definitions: Adverse reaction, Serious adverse reaction"}
            ],
            "links": [
                {"source": "REG_2019_6::Art77(1-11)", "target": "DIR_2001_82::Art75(1-2)", "strength": 0.9997, "axis": "access"},
                {"source": "DIR_2001_82::Art1_10,12", "target": "REG_2019_6::Art77(1-11)", "strength": 0.9997, "axis": "access"},
                {"source": "DIR_2001_82::Art1_10,12", "target": "REG_2019_6::Art77(1-11)", "strength": 0.9997, "axis": "governance"}
            ]
        };
        
        // Regions data (cleaned - no hypothesis_id or edge_id)
        const regionsData = [
            {
                "region_id": "access_region_1",
                "axis": "access",
                "kind": "cross_doc",
                "pair_label": "REG_2019_6 Art77(1-11) ⟂ DIR_2001_82 Art75(1-2)",
                "count_edges": 1,
                "mean_strength": 0.9997,
                "examples": [
                    {
                        "strength": 0.9997,
                        "contradiction_type": "nli_contradiction",
                        "left": {
                            "doc": "REG_2019_6",
                            "sec": "Art77(1-11)",
                            "text": "For each veterinary medicinal product, the marketing authorisation holder shall not have more than one pharmacovigilance system master file."
                        },
                        "right": {
                            "doc": "DIR_2001_82",
                            "sec": "Art75(1-2)",
                            "text": "The marketing authorization holder shall be required to maintain detailed records of all suspected adverse reactions occurring either in the Community or in a third country."
                        }
                    }
                ]
            },
            {
                "region_id": "access_region_2",
                "axis": "access",
                "kind": "cross_doc",
                "pair_label": "DIR_2001_82 Art1_10,12 ⟂ REG_2019_6 Art77(1-11)",
                "count_edges": 1,
                "mean_strength": 0.9997,
                "examples": [
                    {
                        "strength": 0.9997,
                        "contradiction_type": "nli_contradiction",
                        "left": {
                            "doc": "DIR_2001_82",
                            "sec": "Art1_10,12",
                            "text": "Adverse reaction: A reaction which is harmful and unintended and which occurs at doses normally used in animals for the prophylaxis, diagnosis or treatment of disease or the modification of physiological function."
                        },
                        "right": {
                            "doc": "REG_2019_6",
                            "sec": "Art77(1-11)",
                            "text": "The marketing authorisation holder shall not make a public announcement on pharmacovigilance information in relation to its veterinary medicinal products without giving prior or simultaneous notification of its intention to the competent authority."
                        }
                    }
                ]
            },
            {
                "region_id": "governance_region_1",
                "axis": "governance",
                "kind": "cross_doc",
                "pair_label": "DIR_2001_82 Art1_10,12 ⟂ REG_2019_6 Art77(1-11)",
                "count_edges": 1,
                "mean_strength": 0.9997,
                "examples": [
                    {
                        "strength": 0.9997,
                        "contradiction_type": "nli_contradiction",
                        "left": {
                            "doc": "DIR_2001_82",
                            "sec": "Art1_10,12",
                            "text": "Serious adverse reaction: An adverse reaction which results in death, is life-threatening, results in significant disability or incapacity, is a congenital anomaly/birth defect, or which results in permanent or prolonged signs in the animals treated."
                        },
                        "right": {
                            "doc": "REG_2019_6",
                            "sec": "Art77(1-11)",
                            "text": "Those qualified persons shall reside and operate in the Union and shall be appropriately qualified and be permanently at the disposal of the marketing authorisation holder."
                        }
                    }
                ]
            }
        ];
        
        // Populate region list
        const regionList = document.getElementById('region-list');
        regionsData.forEach(region => {
            const item = document.createElement('div');
            item.className = 'region-item';
            item.innerHTML = `
                <div class="axis-tag ${region.axis}">${region.axis}</div>
                <div class="pair-label">${region.pair_label}</div>
                <div class="stats">${region.count_edges} edge(s) • ${(region.mean_strength * 100).toFixed(2)}% mean strength</div>
            `;
            item.addEventListener('click', () => {
                alert(`Region Details:\n\nAxis: ${region.axis}\nPair: ${region.pair_label}\n\nLeft: ${region.examples[0].left.text}\n\nRight: ${region.examples[0].right.text}`);
            });
            regionList.appendChild(item);
        });
        
        // Try to load D3 for graph visualization
        function initD3Graph() {
            const container = document.getElementById('graph-container');
            container.innerHTML = ''; // Clear fallback
            
            const width = container.clientWidth;
            const height = container.clientHeight || 500;
            
            const svg = d3.select('#graph-container')
                .append('svg')
                .attr('viewBox', [0, 0, width, height]);
            
            const simulation = d3.forceSimulation(graphData.nodes)
                .force('link', d3.forceLink(graphData.links).id(d => d.id).distance(120))
                .force('charge', d3.forceManyBody().strength(-300))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide().radius(40));
            
            const link = svg.append('g')
                .selectAll('line')
                .data(graphData.links)
                .join('line')
                .attr('class', d => 'link ' + d.axis)
                .attr('stroke-width', d => Math.max(1, d.strength * 4));
            
            const node = svg.append('g')
                .selectAll('g')
                .data(graphData.nodes)
                .join('g')
                .attr('class', d => 'node ' + (d.group === 1 ? 'reg' : 'dir'))
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended));
            
            node.append('circle')
                .attr('r', 12)
                .on('mouseover', showTooltip)
                .on('mouseout', hideTooltip);
            
            node.append('text')
                .attr('dx', 16)
                .attr('dy', 4)
                .text(d => d.sec || d.id);
            
            simulation.on('tick', () => {
                link
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);
                node.attr('transform', d => `translate(${d.x},${d.y})`);
            });
            
            function dragstarted(event) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                event.subject.fx = event.subject.x;
                event.subject.fy = event.subject.y;
            }
            function dragged(event) {
                event.subject.fx = event.x;
                event.subject.fy = event.y;
            }
            function dragended(event) {
                if (!event.active) simulation.alphaTarget(0);
                event.subject.fx = null;
                event.subject.fy = null;
            }
        }
        
        const tooltip = document.getElementById('tooltip');
        function showTooltip(event, d) {
            tooltip.innerHTML = `
                <div class="doc">${d.doc}</div>
                <div class="sec">${d.sec}</div>
                <div class="text">${d.text}</div>
            `;
            tooltip.style.display = 'block';
            tooltip.style.left = (event.pageX + 15) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';
        }
        function hideTooltip() {
            tooltip.style.display = 'none';
        }
        
        // Load D3 dynamically - if it fails, fallback list remains visible
        const d3Script = document.createElement('script');
        d3Script.src = 'https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js';
        d3Script.onload = initD3Graph;
        d3Script.onerror = () => console.log('D3 unavailable - using static fallback');
        document.head.appendChild(d3Script);
    </script>
</body>
</html>
